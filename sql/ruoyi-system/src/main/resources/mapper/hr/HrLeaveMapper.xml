<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ruoyi.hr.mapper.HrLeaveMapper">
    
    <resultMap type="HrLeave" id="HrLeaveResult">
        <result property="leaveId"    column="leave_id"    />
        <result property="employeeId"    column="employee_id"    />
        <result property="days"    column="days"    />
        <result property="typeNum"    column="type_num"    />
        <result property="startDate"    column="start_date"    />
        <result property="status"    column="status"    />
        <result property="remark"    column="remark"    />
        <result property="createTime"    column="create_time"    />
        <result property="updateTime"    column="update_time"    />
        <result property="isDeleted"    column="is_deleted"    />
    </resultMap>

    <resultMap id="HrLeaveHrEmployeeResult" type="HrLeave" extends="HrLeaveResult">
        <collection property="hrEmployeeList" notNullColumn="sub_employee_id" javaType="java.util.List" resultMap="HrEmployeeResult" />
    </resultMap>

    <resultMap type="HrEmployee" id="HrEmployeeResult">
        <result property="employeeId"    column="sub_employee_id"    />
        <result property="name"    column="sub_name"    />
        <result property="gender"    column="sub_gender"    />
        <result property="birthday"    column="sub_birthday"    />
        <result property="idCard"    column="sub_id_card"    />
        <result property="wedlock"    column="sub_wedlock"    />
        <result property="nation"    column="sub_nation"    />
        <result property="nativePlace"    column="sub_native_place"    />
        <result property="politic"    column="sub_politic"    />
        <result property="email"    column="sub_email"    />
        <result property="phone"    column="sub_phone"    />
        <result property="address"    column="sub_address"    />
        <result property="deptId"    column="sub_dept_id"    />
        <result property="jobLevelId"    column="sub_job_level_id"    />
        <result property="postId"    column="sub_post_id"    />
        <result property="engageForm"    column="sub_engage_form"    />
        <result property="tiptopDegree"    column="sub_tiptop_degree"    />
        <result property="specialty"    column="sub_specialty"    />
        <result property="school"    column="sub_school"    />
        <result property="beginDate"    column="sub_begin_date"    />
        <result property="workState"    column="sub_work_state"    />
        <result property="workId"    column="sub_work_id"    />
        <result property="contractTerm"    column="sub_contract_term"    />
        <result property="conversionTime"    column="sub_conversion_time"    />
        <result property="notWorkDate"    column="sub_not_work_date"    />
        <result property="beginContract"    column="sub_begin_contract"    />
        <result property="endContract"    column="sub_end_contract"    />
        <result property="workAge"    column="sub_work_age"    />
    </resultMap>

    <sql id="selectHrLeaveVo">
        select leave_id, employee_id, days, type_num, start_date, status, remark, create_time, update_time, is_deleted from hr_leave
    </sql>

    <select id="selectHrLeaveList" parameterType="HrLeave" resultMap="HrLeaveResult">
        <include refid="selectHrLeaveVo"/>
        <where>  
            <if test="employeeId != null "> and employee_id = #{employeeId}</if>
            <if test="days != null "> and days = #{days}</if>
            <if test="typeNum != null "> and type_num = #{typeNum}</if>
            <if test="startDate != null "> and start_date = #{startDate}</if>
            <if test="status != null "> and status = #{status}</if>
            <if test="isDeleted != null "> and is_deleted = #{isDeleted}</if>
        </where>
    </select>
    
    <select id="selectHrLeaveByLeaveId" parameterType="Long" resultMap="HrLeaveHrEmployeeResult">
        select a.leave_id, a.employee_id, a.days, a.type_num, a.start_date, a.status, a.remark, a.create_time, a.update_time, a.is_deleted,
 b.employee_id as sub_employee_id, b.name as sub_name, b.gender as sub_gender, b.birthday as sub_birthday, b.id_card as sub_id_card, b.wedlock as sub_wedlock, b.nation as sub_nation, b.native_place as sub_native_place, b.politic as sub_politic, b.email as sub_email, b.phone as sub_phone, b.address as sub_address, b.dept_id as sub_dept_id, b.job_level_id as sub_job_level_id, b.post_id as sub_post_id, b.engage_form as sub_engage_form, b.tiptop_degree as sub_tiptop_degree, b.specialty as sub_specialty, b.school as sub_school, b.begin_date as sub_begin_date, b.work_state as sub_work_state, b.work_id as sub_work_id, b.contract_term as sub_contract_term, b.conversion_time as sub_conversion_time, b.not_work_date as sub_not_work_date, b.begin_contract as sub_begin_contract, b.end_contract as sub_end_contract, b.work_age as sub_work_age
        from hr_leave a
        left join hr_employee b on b.employee_id = a.leave_id
        where a.leave_id = #{leaveId}
    </select>
        
    <insert id="insertHrLeave" parameterType="HrLeave" useGeneratedKeys="true" keyProperty="leaveId">
        insert into hr_leave
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="employeeId != null">employee_id,</if>
            <if test="days != null">days,</if>
            <if test="typeNum != null">type_num,</if>
            <if test="startDate != null">start_date,</if>
            <if test="status != null">status,</if>
            <if test="remark != null">remark,</if>
            <if test="createTime != null">create_time,</if>
            <if test="updateTime != null">update_time,</if>
            <if test="isDeleted != null">is_deleted,</if>
         </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="employeeId != null">#{employeeId},</if>
            <if test="days != null">#{days},</if>
            <if test="typeNum != null">#{typeNum},</if>
            <if test="startDate != null">#{startDate},</if>
            <if test="status != null">#{status},</if>
            <if test="remark != null">#{remark},</if>
            <if test="createTime != null">#{createTime},</if>
            <if test="updateTime != null">#{updateTime},</if>
            <if test="isDeleted != null">#{isDeleted},</if>
         </trim>
    </insert>

    <update id="updateHrLeave" parameterType="HrLeave">
        update hr_leave
        <trim prefix="SET" suffixOverrides=",">
            <if test="employeeId != null">employee_id = #{employeeId},</if>
            <if test="days != null">days = #{days},</if>
            <if test="typeNum != null">type_num = #{typeNum},</if>
            <if test="startDate != null">start_date = #{startDate},</if>
            <if test="status != null">status = #{status},</if>
            <if test="remark != null">remark = #{remark},</if>
            <if test="createTime != null">create_time = #{createTime},</if>
            <if test="updateTime != null">update_time = #{updateTime},</if>
            <if test="isDeleted != null">is_deleted = #{isDeleted},</if>
        </trim>
        where leave_id = #{leaveId}
    </update>

    <delete id="deleteHrLeaveByLeaveId" parameterType="Long">
        delete from hr_leave where leave_id = #{leaveId}
    </delete>

    <delete id="deleteHrLeaveByLeaveIds" parameterType="String">
        delete from hr_leave where leave_id in 
        <foreach item="leaveId" collection="array" open="(" separator="," close=")">
            #{leaveId}
        </foreach>
    </delete>
    
    <delete id="deleteHrEmployeeByEmployeeIds" parameterType="String">
        delete from hr_employee where employee_id in 
        <foreach item="employeeId" collection="array" open="(" separator="," close=")">
            #{employeeId}
        </foreach>
    </delete>

    <delete id="deleteHrEmployeeByEmployeeId" parameterType="Long">
        delete from hr_employee where employee_id = #{employeeId}
    </delete>

    <insert id="batchHrEmployee">
        insert into hr_employee( employee_id, name, gender, birthday, id_card, wedlock, nation, native_place, politic, email, phone, address, dept_id, job_level_id, post_id, engage_form, tiptop_degree, specialty, school, begin_date, work_state, work_id, contract_term, conversion_time, not_work_date, begin_contract, end_contract, work_age) values
		<foreach item="item" index="index" collection="list" separator=",">
            ( #{item.employeeId}, #{item.name}, #{item.gender}, #{item.birthday}, #{item.idCard}, #{item.wedlock}, #{item.nation}, #{item.nativePlace}, #{item.politic}, #{item.email}, #{item.phone}, #{item.address}, #{item.deptId}, #{item.jobLevelId}, #{item.postId}, #{item.engageForm}, #{item.tiptopDegree}, #{item.specialty}, #{item.school}, #{item.beginDate}, #{item.workState}, #{item.workId}, #{item.contractTerm}, #{item.conversionTime}, #{item.notWorkDate}, #{item.beginContract}, #{item.endContract}, #{item.workAge})
        </foreach>
    </insert>
</mapper>